#!/bin/bash
# Configure PerlOnJava build environment

# Detect and configure database drivers
if [ -d "jdbc-drivers" ]; then
  for driver in jdbc-drivers/*.jar; do
    echo "Adding JDBC driver: $driver"
    artifactId=$(basename $driver .jar)
    
    # Install to local Maven repository
    echo "Installing new driver: $artifactId"
    mvn install:install-file -Dfile=$driver -DgroupId=local -DartifactId=$artifactId -Dversion=1.0 -Dpackaging=jar

    # Add to build.gradle if it exists
    if [ -f "build.gradle" ]; then
      if ! grep -q "implementation 'local:$artifactId:1.0'" build.gradle; then
        sed -i.bak '/dependencies {/a \
    implementation "local:'"$artifactId"':1.0"\
' build.gradle
      else
        echo "Driver $artifactId already configured in build.gradle"
      fi
    fi

    # Add to pom.xml if it exists
    if [ -f "pom.xml" ]; then
      if ! grep -q "<artifactId>$artifactId</artifactId>" pom.xml; then
        sed -i.bak '/<dependencies>/a \
        <dependency>\
            <groupId>local</groupId>\
            <artifactId>'"$artifactId"'</artifactId>\
            <version>1.0</version>\
        </dependency>\
' pom.xml
      else
        echo "Driver $artifactId already configured in pom.xml"
      fi
    fi

  done
fi

echo "Build configuration complete"

